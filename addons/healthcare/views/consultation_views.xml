<odoo>
    <!-- ACTION -->
    <record id="mch_consultation_action" model="ir.actions.act_window">
        <field name="name">Consultations</field>
        <field name="res_model">mch.consultation</field>
        <field name="view_mode">tree,form,calendar</field>
    </record>

    <!-- TREE VIEW -->
    <record id="mch_consultation_tree_view" model="ir.ui.view">
        <field name="name">mch.consultation.tree</field>
        <field name="model">mch.consultation</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="patient_id"/>
                <field name="provider_id"/>
                <field name="facility_id"/>
                <field name="date"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <!-- FORM VIEW -->
    <record id="mch_consultation_form_view" model="ir.ui.view">
        <field name="name">mch.consultation.form</field>
        <field name="model">mch.consultation</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_start_consultation" string="Start Consultation" type="object"
                            class="btn-primary o_invisible" modifiers="{'invisible': [['state', '!=', 'draft']]}"/>
                    
                    <button name="action_complete_consultation" string="Complete Consultation" type="object"
                            class="btn-primary o_invisible" modifiers="{'invisible': [['state', '!=', 'in_progress']]}"/>
                    
                    <button name="action_cancel_consultation" string="Cancel" type="object"
                            class="btn-secondary o_invisible" modifiers="{'invisible': [['state', 'in', ['completed', 'canceled']]]}"/>
                    
                    <field name="state" widget="statusbar"/>
                </header>

                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>

                    <group>
                        <group>
                            <field name="patient_id"/>
                            <field name="provider_id"/>
                            <field name="facility_id"/>
                            <field name="date"/>
                        </group>
                        <group>
                            <field name="reason"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Vitals">
                            <group>
                                <group>
                                    <field name="height"/>
                                    <field name="weight"/>
                                    <field name="bmi" readonly="1"/>
                                </group>
                                <group>
                                    <field name="temperature"/>
                                    <field name="blood_pressure"/>
                                    <field name="pulse"/>
                                    <field name="respiratory_rate"/>
                                </group>
                            </group>
                        </page>

                        <page string="Clinical Notes">
                            <field name="notes"/>
                        </page>

                        <page string="Diagnoses">
                            <field name="diagnosis_ids" mode="tree,form">
                                <tree>
                                    <field name="icd_code"/>
                                    <field name="description"/>
                                    <field name="is_chronic"/>
                                </tree>
                                <form>
                                    <group>
                                        <field name="icd_code"/>
                                        <field name="description"/>
                                        <field name="is_chronic"/>
                                        <field name="severity"/>
                                        <field name="notes"/>
                                    </group>
                                </form>
                            </field>
                        </page>

                        <page string="Tests">
                            <field name="test_ids" mode="tree,form">
                                <tree>
                                    <field name="name"/>
                                    <field name="test_type_id"/>
                                    <field name="state"/>
                                </tree>
                                <form>
                                    <group>
                                        <field name="test_type_id"/>
                                        <field name="date_ordered"/>
                                        <field name="date_collected"/>
                                        <field name="result"/>
                                    </group>
                                </form>
                            </field>
                        </page>

                        <page string="Prescriptions">
                            <field name="prescription_ids" mode="tree,form">
                                <tree>
                                    <field name="name"/>
                                    <field name="date_prescribed"/>
                                    <field name="state"/>
                                </tree>
                                <form>
                                    <group>
                                        <field name="prescription_line_ids" mode="tree,form">
                                            <tree>
                                                <field name="product_id"/>
                                                <field name="quantity"/>
                                                <field name="fulfilled_qty"/>
                                                <field name="remaining_qty"/>
                                            </tree>
                                            <form>
                                                <group>
                                                    <field name="product_id"/>
                                                    <field name="is_vaccine"/>
                                                    <field name="dose"/>
                                                    <field name="route"/>
                                                    <field name="frequency"/>
                                                    <field name="duration"/>
                                                    <field name="quantity"/>
                                                    <field name="notes"/>
                                                </group>
                                            </form>
                                        </field>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- CALENDAR VIEW -->
    <record id="mch_consultation_calendar_view" model="ir.ui.view">
        <field name="name">mch.consultation.calendar</field>
        <field name="model">mch.consultation</field>
        <field name="arch" type="xml">
            <calendar date_start="date" color="provider_id">
                <field name="patient_id"/>
                <field name="provider_id"/>
                <field name="facility_id"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>



    <!-- Kanban View for Dashboard -->
    <!-- Consultation Kanban View (FIXED) -->
    <record id="mch_consultation_kanban_view" model="ir.ui.view">
        <field name="name">mch.consultation.kanban</field>
        <field name="model">mch.consultation</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state">
                <field name="state"/>
                <field name="date"/>
                <field name="patient_id"/>
                <field name="provider_id"/>
                <field name="facility_id"/>
                
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="oe_kanban_details">
                                    <strong>
                                        <field name="patient_id"/>
                                    </strong>
                                    <div>
                                        Date: <field name="date"/>
                                    </div>
                                    <div>
                                        Provider: <field name="provider_id"/>
                                    </div>
                                    <div>
                                        Facility: <field name="facility_id"/>
                                    </div>
                                    <div>
                                        Status: 
                                        <span t-attf-class="oe_kanban_badge_#{record.state.raw_value == 'completed' ? 'success' : record.state.raw_value == 'in_progress' ? 'warning' : 'default'}">
                                            <field name="state"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
</odoo>