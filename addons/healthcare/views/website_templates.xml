<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="provider_login_template" name="Provider Login">
        <t t-call="website.layout">
            <style>
                .provider-login {
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                    min-height: 100vh;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 2rem 0;
                }
                
                .login-card {
                    background: white;
                    border-radius: 20px;
                    padding: 3rem;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                    width: 100%;
                    max-width: 400px;
                }
            </style>

            <section class="provider-login">
                <div class="login-card text-center">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #2563eb, #8b5cf6); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fa fa-stethoscope"></i>
                    </div>
                    
                    <h3 class="fw-bold mb-3">Provider Login</h3>
                    <p class="text-muted mb-4">Access your healthcare provider dashboard</p>
                    
                    <form method="post" action="/web/login" class="mt-4">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <input type="hidden" name="redirect" value="/mch/provider/dashboard"/>
                        
                        <div class="mb-3">
                            <input type="text" name="login" class="form-control" placeholder="Email or Username" required="required"/>
                        </div>
                        
                        <div class="mb-4">
                            <input type="password" name="password" class="form-control" placeholder="Password" required="required"/>
                        </div>
                        
                        <button type="submit" class="btn w-100 py-2 fw-semibold" style="background: linear-gradient(135deg, #2563eb, #8b5cf6); border: none; border-radius: 50px; color: white;">
                            <i class="fa fa-sign-in-alt me-2"></i>Login as Provider
                        </button>
                    </form>
                    
                    <div class="mt-4 pt-3 border-top">
                        <p class="text-muted small mb-2">Not a provider?</p>
                        <a href="/web/login" class="btn btn-outline-secondary btn-sm">
                            <i class="fa fa-user me-1"></i>Patient Login
                        </a>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <template id="mch_homepage_template" name="MCH Homepage">
        <t t-call="website.layout">
            <!-- Simplified CSS without complex strings -->
            <style>
                .healthcare-hero {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 5rem 0;
                    position: relative;
                    overflow: hidden;
                }
                
                .hero-content {
                    position: relative;
                    z-index: 2;
                }
                
                .feature-card {
                    border: none;
                    border-radius: 20px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                    transition: all 0.3s ease;
                    background: white;
                    overflow: hidden;
                }
                
                .feature-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
                }
                
                .feature-icon {
                    width: 80px;
                    height: 80px;
                    background: linear-gradient(135deg, #2563eb, #8b5cf6);
                    border-radius: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 1.5rem;
                    color: white;
                    font-size: 2rem;
                }
                
                .service-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 2rem;
                    margin: 3rem 0;
                }
                
                .service-item {
                    text-align: center;
                    padding: 2rem;
                    background: white;
                    border-radius: 15px;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                    transition: all 0.3s ease;
                }
                
                .service-item:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
                }
                
                .service-icon {
                    font-size: 2.5rem;
                    color: #2563eb;
                    margin-bottom: 1rem;
                }
                
                .btn-healthcare {
                    background: linear-gradient(135deg, #2563eb, #8b5cf6);
                    border: none;
                    border-radius: 50px;
                    padding: 12px 30px;
                    font-weight: 600;
                    color: white;
                    transition: all 0.3s ease;
                }
                
                .btn-healthcare:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
                    color: white;
                }
                
                .stats-section {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 4rem 0;
                }
                
                .stat-number {
                    font-size: 3rem;
                    font-weight: bold;
                    color: white;
                }
                
                .gradient-bg {
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                }
            </style>
            
            <!-- Hero Section -->
            <section class="healthcare-hero">
                <div class="container">
                    <div class="row align-items-center hero-content">
                        <div class="col-lg-6">
                            <h1 class="display-4 fw-bold mb-4">Caring for Generations</h1>
                            <p class="lead mb-4">Comprehensive maternal and child healthcare services with compassion and excellence. Your family's health is our priority.</p>
                            <div class="d-flex gap-3">
                                <a href="/mch/provider/login" class="btn btn-outline-light btn-lg px-4 py-3 rounded-pill fw-semibold">
                                    <i class="fa fa-stethoscope me-2"></i>Provider Login
                                </a>
                                
                                <a href="/mch/provider/signup" class="btn btn-outline-light btn-lg px-4 py-3 rounded-pill fw-semibold">
                                    <i class="fa fa-stethoscope me-2"></i>Provider Join
                                </a>
                            </div>
                        </div>
                        <div class="col-lg-6 text-center">
                            <img src="/web/static/src/img/website_hero.png" class="img-fluid" alt="Healthcare Hero" style="max-height: 400px;"/>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Stats Section -->
            <section class="stats-section">
                <div class="container">
                    <div class="row text-center">
                        <div class="col-md-3 col-6 mb-4">
                            <div class="stat-number">500+</div>
                            <p class="mb-0">Qualified Providers</p>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <div class="stat-number">10K+</div>
                            <p class="mb-0">Happy Families</p>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <div class="stat-number">25+</div>
                            <p class="mb-0">Facilities</p>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <div class="stat-number">98%</div>
                            <p class="mb-0">Satisfaction Rate</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Services Section -->
            <section class="py-5 gradient-bg">
                <div class="container">
                    <div class="text-center mb-5">
                        <h2 class="display-5 fw-bold mb-3">Our Comprehensive Services</h2>
                        <p class="lead text-muted">From prenatal care to childhood wellness, we're here for every step</p>
                    </div>
                    
                    <div class="service-grid">
                        <div class="service-item">
                            <div class="service-icon">ü§∞</div>
                            <h4>Prenatal Care</h4>
                            <p class="text-muted">Comprehensive care for expecting mothers and their babies</p>
                        </div>
                        <div class="service-item">
                            <div class="service-icon">üíâ</div>
                            <h4>Vaccinations</h4>
                            <p class="text-muted">Complete immunization schedule for children of all ages</p>
                        </div>
                        <div class="service-item">
                            <div class="service-icon">üçé</div>
                            <h4>Nutrition</h4>
                            <p class="text-muted">Expert guidance on maternal and child nutrition</p>
                        </div>
                        <div class="service-item">
                            <div class="service-icon">üß†</div>
                            <h4>Development</h4>
                            <p class="text-muted">Monitoring and support for child development milestones</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CTA Section -->
            <section class="py-5">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-6">
                            <h2 class="fw-bold mb-4">Ready to Get Started?</h2>
                            <p class="lead mb-4">Join thousands of families who trust us with their healthcare needs. Schedule your appointment today.</p>
                            <div class="d-flex gap-3">
                                <a href="/mch/providers" class="btn btn-healthcare">
                                    <i class="fa fa-search me-2"></i>Find a Provider
                                </a>
                                <a href="/mch/facilities" class="btn btn-outline-primary">
                                    <i class="fa fa-map-marker me-2"></i>Find a Facility
                                </a>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <img src="/web/static/src/img/website_cta.png" class="img-fluid rounded-3" alt="Healthcare Team"/>
                        </div>
                    </div>
                </div>
            </section>
        </t>
    </template>


    <template id="provider_patient_registration_template" name="Provider Patient Registration">
        <t t-call="website.layout">
            <style>
                .provider-dashboard {
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                    min-height: 100vh;
                    padding: 2rem 0;
                }
                
                .dashboard-card {
                    background: white;
                    border-radius: 20px;
                    padding: 2rem;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                    margin-bottom: 2rem;
                }
                
                .form-section {
                    margin-bottom: 2rem;
                }
                
                .tab-content {
                    padding: 2rem 0;
                }
            </style>

            <section class="provider-dashboard">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="dashboard-card">
                                <h4 class="fw-bold mb-4">Provider Dashboard</h4>
                                <div class="list-group">
                                    <a href="/mch/provider/dashboard" class="list-group-item list-group-item-action">
                                        <i class="fa fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                    <a href="/mch/provider/patients" class="list-group-item list-group-item-action">
                                        <i class="fa fa-users me-2"></i>My Patients
                                    </a>
                                    <a href="/mch/provider/register-patient" class="list-group-item list-group-item-action active">
                                        <i class="fa fa-user-plus me-2"></i>Register Patient
                                    </a>
                                    <a href="/mch/provider/vaccinations" class="list-group-item list-group-item-action">
                                        <i class="fa fa-syringe me-2"></i>Vaccinations
                                    </a>
                                    <a href="/mch/provider/vaccinations" class="list-group-item list-group-item-action">
                                        <i class="fa fa-list me-2"></i>Vaccination Records
                                    </a>
                                    <a href="/web/session/logout" class="list-group-item list-group-item-action text-danger">
                                        <i class="fa fa-sign-out-alt me-2"></i>Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-9">
                            <div class="dashboard-card">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Register New Patient</h3>
                                    <span class="badge bg-primary">
                                        <i class="fa fa-stethoscope me-1"></i>
                                        <t t-esc="provider.name"/>
                                    </span>
                                </div>

                                <ul class="nav nav-tabs" id="patientTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="adult-tab" data-bs-toggle="tab" data-bs-target="#adult" type="button" role="tab">
                                            Adult Patient
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="child-tab" data-bs-toggle="tab" data-bs-target="#child" type="button" role="tab">
                                            Child Patient
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content" id="patientTabsContent">
                                    <!-- Adult Patient Form -->
                                    <div class="tab-pane fade show active" id="adult" role="tabpanel">
                                        <form method="post" class="mt-3">
                                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                            <input type="hidden" name="is_child" value="false"/>
                                            
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Full Name *</label>
                                                    <input type="text" class="form-control" name="name" required="required" placeholder="Patient's full name"/>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Date of Birth *</label>
                                                    <input type="date" class="form-control" name="date_of_birth" required="required"/>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Gender *</label>
                                                    <select class="form-control" name="gender" required="required">
                                                        <option value="">Select Gender</option>
                                                        <option value="male">Male</option>
                                                        <option value="female">Female</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Blood Type</label>
                                                    <select class="form-control" name="blood_type">
                                                        <option value="">Select Blood Type</option>
                                                        <option value="A+">A+</option>
                                                        <option value="A-">A-</option>
                                                        <option value="B+">B+</option>
                                                        <option value="B-">B-</option>
                                                        <option value="AB+">AB+</option>
                                                        <option value="AB-">AB-</option>
                                                        <option value="O+">O+</option>
                                                        <option value="O-">O-</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Is Pregnant?</label>
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" name="is_pregnant" id="is_pregnant"/>
                                                    <label class="form-check-label" for="is_pregnant">Yes, this patient is pregnant</label>
                                                </div>
                                            </div>

                                            <div class="row" id="pregnancy_fields" style="display: none;">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Pregnancy Week</label>
                                                    <input type="number" class="form-control" name="pregnancy_week" min="1" max="42"/>
                                                </div>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Allergies</label>
                                                <textarea class="form-control" name="allergies" rows="3" placeholder="List any known allergies"></textarea>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Medical History</label>
                                                <textarea class="form-control" name="medical_history" rows="3" placeholder="Relevant medical history"></textarea>
                                            </div>

                                            <button type="submit" class="btn btn-primary btn-lg">
                                                <i class="fa fa-save me-2"></i>Register Patient
                                            </button>
                                        </form>
                                    </div>

                                    <!-- Child Patient Form -->
                                    <div class="tab-pane fade" id="child" role="tabpanel">
                                        <form method="post" class="mt-3">
                                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                            <input type="hidden" name="is_child" value="true"/>
                                            
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Child's Name *</label>
                                                    <input type="text" class="form-control" name="name" required="required" placeholder="Child's full name"/>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Date of Birth *</label>
                                                    <input type="date" class="form-control" name="date_of_birth" required="required"/>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Gender *</label>
                                                    <select class="form-control" name="gender" required="required">
                                                        <option value="">Select Gender</option>
                                                        <option value="male">Male</option>
                                                        <option value="female">Female</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Blood Type</label>
                                                    <select class="form-control" name="blood_type">
                                                        <option value="">Select Blood Type</option>
                                                        <option value="A+">A+</option>
                                                        <option value="A-">A-</option>
                                                        <option value="B+">B+</option>
                                                        <option value="B-">B-</option>
                                                        <option value="AB+">AB+</option>
                                                        <option value="AB-">AB-</option>
                                                        <option value="O+">O+</option>
                                                        <option value="O-">O-</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Birth Weight (kg)</label>
                                                    <input type="number" step="0.01" class="form-control" name="birth_weight" placeholder="e.g., 3.2"/>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label class="form-label fw-semibold">Birth Height (cm)</label>
                                                    <input type="number" step="0.1" class="form-control" name="birth_height" placeholder="e.g., 50.5"/>
                                                </div>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Mother's Information</label>
                                                <select class="form-control" name="mother_id">
                                                    <option value="">Select Mother (if registered)</option>
                                                    <t t-foreach="existing_patients" t-as="patient">
                                                        <option t-att-value="patient.id">
                                                            <t t-esc="patient.name"/> - <t t-esc="patient.date_of_birth"/>
                                                        </option>
                                                    </t>
                                                </select>
                                                <small class="text-muted">Or leave blank to register mother separately</small>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Allergies</label>
                                                <textarea class="form-control" name="allergies" rows="2" placeholder="List any known allergies"></textarea>
                                            </div>

                                            <button type="submit" class="btn btn-primary btn-lg">
                                                <i class="fa fa-save me-2"></i>Register Child
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    // Show/hide pregnancy fields
                    document.getElementById('is_pregnant').addEventListener('change', function() {
                        document.getElementById('pregnancy_fields').style.display = this.checked ? 'block' : 'none';
                    });
                </script>
            </section>
        </t>
    </template>

    <template id="provider_vaccination_template" name="Provider Vaccination">
        <t t-call="website.layout">
            <style>
                .vaccination-form {
                    background: white;
                    border-radius: 20px;
                    padding: 2rem;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                    margin: 2rem auto;
                    max-width: 800px;
                }
                .patient-suggestions {
                    position: absolute;
                    background: white;
                    border: 1px solid #ccc;
                    max-height: 200px;
                    overflow-y: auto;
                    z-index: 1000;
                    display: none;
                }
                .patient-suggestion {
                    padding: 8px 12px;
                    cursor: pointer;
                    border-bottom: 1px solid #eee;
                }
                .patient-suggestion:hover, .patient-suggestion.active {
                    background-color: #f8f9fa;
                }
            </style>

            <section class="provider-dashboard">
                <div class="container">
                    <div class="vaccination-form">
                        <div class="text-center mb-4">
                            <h2 class="fw-bold">
                                <i class="fa fa-syringe me-2"></i>Administer Vaccination
                            </h2>
                            <p class="text-muted">Record vaccination details for a patient</p>
                        </div>

                        <form method="post" class="mt-4">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Patient *</label>
                                    <input type="text" 
                                           class="form-control patient-autocomplete" 
                                           name="patient_name" 
                                           id="patient_autocomplete"
                                           placeholder="Start typing patient name..."
                                           required="required"
                                           autocomplete="off"/>
                                    <input type="hidden" name="patient_id" id="patient_id"/>
                                    <small class="text-muted">Type patient name and select from dropdown</small>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Vaccine *</label>
                                    <select class="form-control" name="vaccine_id" required="required">
                                        <option value="">Select Vaccine</option>
                                        <t t-foreach="vaccines" t-as="vaccine">
                                            <option t-att-value="vaccine.id">
                                                <t t-esc="vaccine.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Date &amp; Time *</label>
                                    <input type="datetime-local" class="form-control" name="date_administered" required="required" 
                                        t-att-value="default_datetime"/>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Batch/Lot Number</label>
                                    <input type="text" class="form-control" name="lot_id" placeholder="Enter batch number"/>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-semibold">Dose</label>
                                    <input type="number" step="0.01" class="form-control" name="dose" placeholder="e.g., 0.5"/>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-semibold">Route</label>
                                    <select class="form-control" name="route">
                                        <option value="">Select Route</option>
                                        <option value="im">Intramuscular</option>
                                        <option value="sc">Subcutaneous</option>
                                        <option value="oral">Oral</option>
                                        <option value="nasal">Nasal</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-semibold">Site</label>
                                    <select class="form-control" name="site">
                                        <option value="">Select Site</option>
                                        <option value="left_arm">Left Arm</option>
                                        <option value="right_arm">Right Arm</option>
                                        <option value="left_thigh">Left Thigh</option>
                                        <option value="right_thigh">Right Thigh</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">Notes</label>
                                <textarea class="form-control" name="notes" rows="3" placeholder="Any additional notes or observations"></textarea>
                            </div>

                            <input type="hidden" name="administered_by" t-att-value="provider.id"/>
                            <input type="hidden" name="facility_id" t-att-value="provider.facility_id.id"/>

                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fa fa-check-circle me-2"></i>Record Vaccination
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <script>
            <![CDATA[
                document.addEventListener('DOMContentLoaded', function() {
                    const patientInput = document.getElementById('patient_autocomplete');
                    const patientIdInput = document.getElementById('patient_id');
                    let suggestionsDiv = null;

                    function createSuggestionsContainer() {
                        if (!suggestionsDiv) {
                            suggestionsDiv = document.createElement('div');
                            suggestionsDiv.className = 'patient-suggestions';
                            document.body.appendChild(suggestionsDiv);
                        }
                        return suggestionsDiv;
                    }

                    function searchPatients(searchTerm) {
                        if (searchTerm.length < 2) {
                            if (suggestionsDiv) suggestionsDiv.style.display = 'none';
                            return;
                        }

                        fetch('/mch/patient/search?term=' + encodeURIComponent(searchTerm))
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }
                                return response.json();
                            })
                            .then(patients => {
                                displaySuggestions(patients);
                            })
                            .catch(error => {
                                console.error('Error searching patients:', error);
                                if (suggestionsDiv) suggestionsDiv.style.display = 'none';
                            });
                    }

                    function displaySuggestions(patients) {
                        const suggestionsDiv = createSuggestionsContainer();
                        
                        if (patients.length === 0) {
                            suggestionsDiv.style.display = 'none';
                            return;
                        }

                        suggestionsDiv.innerHTML = '';
                        patients.forEach(patient => {
                            const div = document.createElement('div');
                            div.className = 'patient-suggestion';
                            div.textContent = patient.name + ' (' + patient.facility + ') - ' + patient.dob;
                            div.setAttribute('data-patient-id', patient.id);
                            div.setAttribute('data-patient-name', patient.name);
                            
                            div.addEventListener('click', function() {
                                patientInput.value = patient.name;
                                patientIdInput.value = patient.id;
                                suggestionsDiv.style.display = 'none';
                            });
                            
                            suggestionsDiv.appendChild(div);
                        });

                        // Position the dropdown
                        const rect = patientInput.getBoundingClientRect();
                        suggestionsDiv.style.width = rect.width + 'px';
                        suggestionsDiv.style.top = (rect.bottom + window.scrollY) + 'px';
                        suggestionsDiv.style.left = (rect.left + window.scrollX) + 'px';
                        suggestionsDiv.style.display = 'block';
                    }

                    // Debounce function to limit API calls
                    function debounce(func, wait) {
                        let timeout;
                        return function executedFunction(...args) {
                            const later = () => {
                                clearTimeout(timeout);
                                func(...args);
                            };
                            clearTimeout(timeout);
                            timeout = setTimeout(later, wait);
                        };
                    }

                    const debouncedSearch = debounce(searchPatients, 300);

                    // Event listeners
                    if (patientInput) {
                        patientInput.addEventListener('input', function(e) {
                            debouncedSearch(e.target.value);
                        });

                        patientInput.addEventListener('focus', function() {
                            if (suggestionsDiv && suggestionsDiv.children.length > 0) {
                                suggestionsDiv.style.display = 'block';
                            }
                        });

                        // Hide suggestions when clicking outside
                        document.addEventListener('click', function(e) {
                            if (suggestionsDiv && 
                                !patientInput.contains(e.target) && 
                                !suggestionsDiv.contains(e.target)) {
                                suggestionsDiv.style.display = 'none';
                            }
                        });

                        // Handle keyboard navigation
                        patientInput.addEventListener('keydown', function(e) {
                            if (!suggestionsDiv || suggestionsDiv.style.display === 'none') return;

                            const suggestions = suggestionsDiv.querySelectorAll('.patient-suggestion');
                            const activeSuggestion = suggestionsDiv.querySelector('.patient-suggestion.active');
                            
                            if (e.key === 'ArrowDown') {
                                e.preventDefault();
                                if (!activeSuggestion) {
                                    suggestions[0]?.classList.add('active');
                                } else {
                                    const next = activeSuggestion.nextElementSibling;
                                    if (next) {
                                        activeSuggestion.classList.remove('active');
                                        next.classList.add('active');
                                    }
                                }
                            } else if (e.key === 'ArrowUp') {
                                e.preventDefault();
                                if (activeSuggestion) {
                                    const prev = activeSuggestion.previousElementSibling;
                                    activeSuggestion.classList.remove('active');
                                    if (prev) {
                                        prev.classList.add('active');
                                    }
                                }
                            } else if (e.key === 'Enter' && activeSuggestion) {
                                e.preventDefault();
                                activeSuggestion.click();
                            }
                        });
                    }
                });
            ]]>
            </script>
        </t>
    </template>
    
    <template id="provider_success_template" name="Provider Success">
        <t t-call="website.layout">
            <section class="provider-dashboard">
                <div class="container">
                    <div class="vaccination-form text-center">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                            <i class="fa fa-check"></i>
                        </div>
                        <h3 class="fw-bold text-success mb-3">Success!</h3>
                        <p class="lead mb-4" t-esc="message"/>
                        <div class="d-flex gap-3 justify-content-center">
                            <a href="/mch/provider/dashboard" class="btn btn-primary">
                                <i class="fa fa-tachometer-alt me-2"></i>Return to Dashboard
                            </a>
                            <a t-att-href="next_action_url" class="btn btn-outline-primary" t-att-data-next-action="next_action">
                                <i class="fa fa-plus me-2"></i>
                                <t t-esc="next_action_label"/>
                            </a>
                        </div>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <template id="provider_vaccination_list_template" name="Provider Vaccination List">
        <t t-call="website.layout">
            <style>
                .vaccination-table {
                    background: white;
                    border-radius: 15px;
                    overflow: hidden;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                }
                
                .badge-administered {
                    background: linear-gradient(135deg, #10b981, #059669);
                }
                
                .badge-pending {
                    background: linear-gradient(135deg, #f59e0b, #d97706);
                }
            </style>

            <section class="provider-dashboard">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="dashboard-card">
                                <h4 class="fw-bold mb-4">Provider Dashboard</h4>
                                <div class="list-group">
                                    <a href="/mch/provider/dashboard" class="list-group-item list-group-item-action">
                                        <i class="fa fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                    <a href="/mch/provider/patients" class="list-group-item list-group-item-action">
                                        <i class="fa fa-users me-2"></i>My Patients
                                    </a>
                                    <a href="/mch/provider/register-patient" class="list-group-item list-group-item-action">
                                        <i class="fa fa-user-plus me-2"></i>Register Patient
                                    </a>
                                    <a href="/mch/provider/vaccinate" class="list-group-item list-group-item-action">
                                        <i class="fa fa-syringe me-2"></i>Administer Vaccination
                                    </a>
                                    <a href="/mch/provider/vaccinations" class="list-group-item list-group-item-action active">
                                        <i class="fa fa-list me-2"></i>Vaccination Records
                                    </a>
                                    <a href="/web/session/logout" class="list-group-item list-group-item-action text-danger">
                                        <i class="fa fa-sign-out-alt me-2"></i>Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-9">
                            <div class="dashboard-card">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Vaccination Records</h3>
                                    <a href="/mch/provider/vaccinate" class="btn btn-primary">
                                        <i class="fa fa-syringe me-2"></i>New Vaccination
                                    </a>
                                </div>

                                <div class="vaccination-table">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Patient</th>
                                                <th>Vaccine</th>
                                                <th>Date</th>
                                                <th>Administered By</th>
                                                <th>Batch/Lot</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="vaccinations" t-as="vaccination">
                                                <tr>
                                                    <td>
                                                        <strong t-esc="vaccination.patient_id.name"/>
                                                        <br/>
                                                        <small class="text-muted" t-esc="vaccination.patient_id.age"/>
                                                        years
                                                    </td>
                                                    <td t-esc="vaccination.vaccine_id.name"/>
                                                    <td>
                                                        <t t-esc="vaccination.date_administered.strftime('%Y-%m-%d %H:%M') if vaccination.date_administered else 'N/A'"/>
                                                    </td>
                                                    <td t-esc="vaccination.administered_by.name"/>
                                                    <td>
                                                        <t t-if="vaccination.lot_id">
                                                            <span class="badge bg-light text-dark" t-esc="vaccination.lot_id"/>
                                                        </t>
                                                        <t t-else="">
                                                            <span class="text-muted">N/A</span>
                                                        </t>
                                                    </td>
                                                    <td>
                                                        <span class="badge badge-administered text-white">
                                                            Administered
                                                        </span>
                                                    </td>
                                                </tr>
                                            </t>
                                            <t t-if="not vaccinations">
                                                <tr>
                                                    <td colspan="6" class="text-center text-muted py-4">
                                                        <i class="fa fa-syringe fa-2x mb-3"></i>
                                                        <p>No vaccination records found.</p>
                                                        <a href="/mch/provider/vaccinate" class="btn btn-primary">
                                                            Record First Vaccination
                                                        </a>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <template id="provider_patient_list_template" name="Provider Patient List">
        <t t-call="website.layout">
            <style>
                .patient-table {
                    background: white;
                    border-radius: 15px;
                    overflow: hidden;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                }
                
                .table th {
                    border-top: none;
                    font-weight: 600;
                    background: #f8f9fa;
                }
                
                .badge-pregnant {
                    background: linear-gradient(135deg, #ec4899, #db2777);
                }
                
                .badge-child {
                    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                }
            </style>

            <section class="provider-dashboard">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-3">
                            <!-- Sidebar from registration template -->
                        </div>
                        
                        <div class="col-lg-9">
                            <div class="dashboard-card">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">My Patients</h3>
                                    <a href="/mch/provider/register-patient" class="btn btn-primary">
                                        <i class="fa fa-user-plus me-2"></i>New Patient
                                    </a>
                                </div>

                                <div class="patient-table">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Age</th>
                                                <th>Gender</th>
                                                <th>Type</th>
                                                <th>Last Visit</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="patients" t-as="patient">
                                                <tr>
                                                    <td>
                                                        <strong t-esc="patient.name"/>
                                                        <t t-if="patient.blood_type">
                                                            <br/><small class="text-muted" t-esc="'Blood: ' + patient.blood_type"/>
                                                        </t>
                                                    </td>
                                                    <td t-esc="patient.age or 'N/A'"/>
                                                    <td>
                                                        <span class="badge bg-light text-dark" t-esc="patient.gender or 'N/A'"/>
                                                    </td>
                                                    <td>
                                                        <t t-if="patient.is_pregnant">
                                                            <span class="badge badge-pregnant text-white">Pregnant</span>
                                                        </t>
                                                        <t t-elif="patient.is_child">
                                                            <span class="badge badge-child text-white">Child</span>
                                                        </t>
                                                        <t t-else="">
                                                            <span class="badge bg-secondary">Adult</span>
                                                        </t>
                                                    </td>
                                                    <td>
                                                        <t t-if="patient.consultation_ids">
                                                            <t t-esc="patient.consultation_ids[0].date.strftime('%Y-%m-%d') if patient.consultation_ids else 'Never'"/>
                                                        </t>
                                                        <t t-else="">
                                                            Never
                                                        </t>
                                                    </td>
                                                    <td>
                                                        <a t-att-href="'/mch/provider/vaccinate?patient_id=' + str(patient.id)" 
                                                        class="btn btn-sm btn-outline-primary me-1" title="Vaccinate">
                                                            <i class="fa fa-syringe"></i>
                                                        </a>
                                                        <a href="#" class="btn btn-sm btn-outline-secondary" title="View Details">
                                                            <i class="fa fa-eye"></i>
                                                        </a>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <template id="provider_dashboard_template" name="Provider Dashboard">
        <t t-call="website.layout">
            <style>
                .provider-dashboard {
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                    min-height: 100vh;
                    padding: 2rem 0;
                }
                
                .dashboard-card {
                    background: white;
                    border-radius: 20px;
                    padding: 2rem;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                    margin-bottom: 2rem;
                }
                
                .stat-card {
                    text-align: center;
                    padding: 1.5rem;
                    border-radius: 15px;
                    background: white;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
                    transition: all 0.3s ease;
                }
                
                .stat-card:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
                }
                
                .stat-number {
                    font-size: 2.5rem;
                    font-weight: bold;
                    margin-bottom: 0.5rem;
                }
                
                .quick-action {
                    padding: 1.5rem;
                    border-radius: 15px;
                    background: white;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
                    transition: all 0.3s ease;
                    text-align: center;
                }
                
                .quick-action:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
                }
                
                .action-icon {
                    font-size: 2rem;
                    margin-bottom: 1rem;
                    color: #2563eb;
                }
            </style>

            <section class="provider-dashboard">
                <div class="container">
                    <!-- Welcome Header -->
                    <div class="row mb-5">
                        <div class="col-12">
                            <div class="dashboard-card text-center">
                                <h1 class="display-5 fw-bold text-primary mb-3">
                                    Welcome, <t t-esc="provider.name"/>
                                </h1>
                                <p class="lead text-muted">
                                    <i class="fa fa-map-marker-alt me-2"></i>
                                    <t t-esc="provider.facility_id.name"/>
                                </p>
                                <p class="text-muted">
                                    <t t-esc="provider.provider_type.title()"/>
                                    <t t-if="provider.license_number"> ‚Ä¢ License: <t t-esc="provider.license_number"/></t>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="row mb-5">
                        <div class="col-md-3 col-6 mb-4">
                            <div class="stat-card">
                                <div class="stat-number text-primary" t-esc="patient_count"/>
                                <p class="text-muted mb-0">Total Patients</p>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <div class="stat-card">
                                <div class="stat-number text-success" t-esc="vaccination_today_count"/>
                                <p class="text-muted mb-0">Vaccinations Today</p>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <div class="stat-card">
                                <div class="stat-number text-warning" t-esc="pregnant_count"/>
                                <p class="text-muted mb-0">Pregnant Patients</p>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <div class="stat-card">
                                <div class="stat-number text-info" t-esc="child_count"/>
                                <p class="text-muted mb-0">Child Patients</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="row mb-5">
                        <div class="col-12">
                            <h3 class="fw-bold mb-4">Quick Actions</h3>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <a href="/mch/provider/register-patient" class="quick-action text-decoration-none">
                                <div class="action-icon">
                                    <i class="fa fa-user-plus"></i>
                                </div>
                                <h5>Register Patient</h5>
                                <p class="text-muted small">Add new patient to system</p>
                            </a>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <a href="/mch/provider/vaccinate" class="quick-action text-decoration-none">
                                <div class="action-icon">
                                    <i class="fa fa-syringe"></i>
                                </div>
                                <h5>Administer Vaccine</h5>
                                <p class="text-muted small">Record vaccination</p>
                            </a>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <a href="/mch/provider/patients" class="quick-action text-decoration-none">
                                <div class="action-icon">
                                    <i class="fa fa-users"></i>
                                </div>
                                <h5>View Patients</h5>
                                <p class="text-muted small">Manage patient records</p>
                            </a>
                        </div>
                        <div class="col-md-3 col-6 mb-4">
                            <a href="/mch/provider/vaccinations" class="quick-action text-decoration-none">
                                <div class="action-icon">
                                    <i class="fa fa-list"></i>
                                </div>
                                <h5>Vaccination Records</h5>
                                <p class="text-muted small">View all vaccinations</p>
                            </a>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="dashboard-card">
                                <h4 class="fw-bold mb-4">Recent Vaccinations</h4>
                                <t t-if="recent_vaccinations">
                                    <div class="list-group">
                                        <t t-foreach="recent_vaccinations" t-as="vaccination">
                                            <div class="list-group-item border-0 px-0">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h6 class="mb-1" t-esc="vaccination.patient_id.name"/>
                                                        <small class="text-muted" t-esc="vaccination.vaccine_id.name"/>
                                                    </div>
                                                    <small class="text-muted">
                                                        <t t-esc="vaccination.date_administered.strftime('%b %d')"/>
                                                    </small>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </t>
                                <t t-else="">
                                    <p class="text-muted">No recent vaccinations</p>
                                </t>
                                <a href="/mch/provider/vaccinations" class="btn btn-outline-primary btn-sm mt-3">
                                    View All Vaccinations
                                </a>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="dashboard-card">
                                <h4 class="fw-bold mb-4">Upcoming Appointments</h4>
                                <p class="text-muted">Appointment scheduling coming soon...</p>
                                <a href="#" class="btn btn-outline-secondary btn-sm mt-3" disabled="disabled">
                                    Schedule Appointment
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </t>
    </template>



    <template id="provider_list_template" name="Provider List">
        <t t-call="website.layout">
            <style>
                .provider-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 2rem;
                    margin: 3rem 0;
                }
                
                .filter-section {
                    background: white;
                    padding: 2rem;
                    border-radius: 15px;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                    margin-bottom: 3rem;
                }
                
                .provider-card {
                    border: none;
                    border-radius: 15px;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                    transition: all 0.3s ease;
                    overflow: hidden;
                }
                
                .provider-card:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
                }
            </style>

            <section class="py-5" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); min-height: 100vh;">
                <div class="container">
                    <div class="text-center mb-5">
                        <h1 class="display-5 fw-bold">Meet Our Healthcare Providers</h1>
                        <p class="lead text-muted">Experienced professionals dedicated to your family's health</p>
                    </div>

                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="Search providers..." id="providerSearch"/>
                            </div>
                            <div class="col-md-4">
                                <select class="form-control" id="specialtyFilter">
                                    <option value="">All Specialties</option>
                                    <option value="doctor">Doctor</option>
                                    <option value="nurse">Nurse</option>
                                    <option value="midwife">Midwife</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-control" id="facilityFilter">
                                    <option value="">All Facilities</option>
                                    <t t-foreach="facilities" t-as="facility">
                                        <option t-att-value="facility.id"><t t-esc="facility.name"/></option>
                                    </t>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="provider-grid">
                        <t t-foreach="providers" t-as="provider">
                            <div class="provider-card">
                                <div class="card-body text-center p-4">
                                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #2563eb, #8b5cf6); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                                        <i class="fa fa-user-md"></i>
                                    </div>
                                    <h4 class="card-title fw-bold" t-esc="provider.name"/>
                                    <p class="text-primary mb-2">
                                        <!-- FIXED: Handle empty provider_type -->
                                        <t t-if="provider.provider_type">
                                            <span t-esc="provider.provider_type.title()"/>
                                            <t t-if="provider.specialty"> - <span t-esc="provider.specialty"/></t>
                                        </t>
                                        <t t-else="">
                                            Healthcare Provider
                                            <t t-if="provider.specialty"> - <span t-esc="provider.specialty"/></t>
                                        </t>
                                    </p>
                                    <t t-if="provider.facility_id">
                                        <p class="text-muted mb-2">
                                            <i class="fa fa-map-marker-alt me-2"></i>
                                            <span t-esc="provider.facility_id.name"/>
                                        </p>
                                    </t>
                                    <a href="#" class="btn btn-outline-primary btn-sm">View Profile</a>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <template id="facility_list_template" name="Facility List">
        <t t-call="website.layout">
            <style>
                .facility-card {
                    border: none;
                    border-radius: 20px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                    transition: all 0.3s ease;
                    overflow: hidden;
                }
                
                .facility-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
                }
                
                .facility-image {
                    height: 200px;
                    object-fit: cover;
                    width: 100%;
                }
            </style>

            <section class="py-5" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);">
                <div class="container">
                    <div class="text-center mb-5">
                        <h1 class="display-5 fw-bold">Our Healthcare Facilities</h1>
                        <p class="lead text-muted">State-of-the-art facilities equipped with modern technology</p>
                    </div>

                    <div class="row">
                        <t t-foreach="facilities" t-as="facility">
                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="facility-card">
                                    <img src="/web/static/src/img/website_facility.png" class="facility-image" alt="Facility"/>
                                    <div class="card-body p-4">
                                        <h4 class="fw-bold" t-esc="facility.name"/>
                                        <p class="text-primary mb-2">
                                            <span t-esc="facility.facility_type.title()"/>
                                        </p>
                                        <p class="text-muted mb-2">
                                            <i class="fa fa-map-marker-alt me-2"></i>
                                            <span t-esc="facility.address"/>
                                        </p>
                                        <p class="text-muted mb-2">
                                            <i class="fa fa-phone me-2"></i>
                                            <span t-esc="facility.phone"/>
                                        </p>
                                        <p class="text-muted mb-3">
                                            <i class="fa fa-envelope me-2"></i>
                                            <span t-esc="facility.email"/>
                                        </p>
                                        <a href="#" class="btn" style="background: linear-gradient(135deg, #2563eb, #8b5cf6); border: none; border-radius: 50px; padding: 8px 20px; font-weight: 600; color: white;">Get Directions</a>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <template id="provider_signup_template" name="Provider Signup">
        <t t-call="website.layout">
            <style>
                .modern-form {
                    background: white;
                    border-radius: 20px;
                    padding: 3rem;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
                }
            </style>

            <section class="py-5" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); min-height: 100vh;">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="modern-form">
                                <div class="text-center mb-4">
                                    <h1 class="display-5 fw-bold">Join Our Healthcare Network</h1>
                                    <p class="text-muted">Become part of our dedicated team of healthcare professionals</p>
                                </div>

                                <form method="post" class="mt-4">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-semibold">Full Name *</label>
                                            <input type="text" class="form-control" name="name" required="required" placeholder="Enter your full name"/>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-semibold">Email Address *</label>
                                            <input type="email" class="form-control" name="email" required="required" placeholder="your.email@example.com"/>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-semibold">Provider Type *</label>
                                            <select class="form-control" name="provider_type" required="required">
                                                <option value="">Select Your Profession</option>
                                                <option value="doctor">Medical Doctor</option>
                                                <option value="nurse">Registered Nurse</option>
                                                <option value="midwife">Certified Midwife</option>
                                                <option value="pharmacist">Pharmacist</option>
                                                <option value="lab_tech">Lab Technician</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-semibold">License Number</label>
                                            <input type="text" class="form-control" name="license_number" placeholder="Your professional license number"/>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label fw-semibold">Facility *</label>
                                        <select class="form-control" name="facility_id" required="required">
                                            <option value="">Select a Facility</option>
                                            <t t-foreach="facilities" t-as="facility">
                                                <option t-att-value="facility.id">
                                                    <t t-esc="facility.name"/> - <t t-esc="facility.facility_type.title()"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>

                                    <button type="submit" class="btn w-100 py-3 fw-semibold" style="background: linear-gradient(135deg, #2563eb, #8b5cf6); border: none; border-radius: 50px; color: white;">
                                        <i class="fa fa-paper-plane me-2"></i>Submit Application
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <template id="provider_thank_you_template" name="Provider Thank You">
        <t t-call="website.layout">
            <section class="py-5" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); min-height: 100vh;">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-6 text-center">
                            <div class="modern-form">
                                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                                    <i class="fa fa-check"></i>
                                </div>
                                <h1 class="display-5 fw-bold text-success mb-3">Application Received!</h1>
                                <p class="lead mb-4">
                                    Thank you for your interest in joining our healthcare network. 
                                    Our team will review your application and contact you within 2-3 business days.
                                </p>
                                <div class="d-flex gap-3 justify-content-center">
                                    <a href="/" class="btn" style="background: linear-gradient(135deg, #2563eb, #8b5cf6); border: none; border-radius: 50px; padding: 12px 30px; font-weight: 600; color: white;">
                                        <i class="fa fa-home me-2"></i>Return Home
                                    </a>
                                    <a href="/mch/providers" class="btn btn-outline-primary">
                                        <i class="fa fa-user-md me-2"></i>Meet Our Team
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <!-- Campaign Fulfillment Template -->
    <template id="provider_campaign_fulfillment_template" name="Provider Campaign Fulfillment">
        <t t-call="website.layout">
            <style>
                .campaign-dashboard {
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                    min-height: 100vh;
                    padding: 2rem 0;
                }
                
                .campaign-hero {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 3rem 2rem;
                    border-radius: 20px;
                    margin-bottom: 2rem;
                }
                
                .stats-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 1.5rem;
                    margin: 2rem 0;
                }
                
                .stat-card {
                    background: white;
                    border-radius: 15px;
                    padding: 1.5rem;
                    text-align: center;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                    transition: all 0.3s ease;
                    border-left: 4px solid;
                }
                
                .stat-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
                }
                
                .stat-card.active {
                    border-left-color: #10b981;
                }
                
                .stat-card.past {
                    border-left-color: #6b7280;
                }
                
                .stat-card.coverage {
                    border-left-color: #3b82f6;
                }
                
                .stat-card.performance {
                    border-left-color: #f59e0b;
                }
                
                .stat-number {
                    font-size: 2.5rem;
                    font-weight: bold;
                    margin-bottom: 0.5rem;
                }
                
                .campaign-badge {
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.875rem;
                }
                
                .badge-active {
                    background: linear-gradient(135deg, #10b981, #059669);
                    color: white;
                }
                
                .badge-expired {
                    background: linear-gradient(135deg, #6b7280, #4b5563);
                    color: white;
                }
                
                .badge-upcoming {
                    background: linear-gradient(135deg, #f59e0b, #d97706);
                    color: white;
                }
                
                .coverage-meter {
                    height: 12px;
                    background: #e5e7eb;
                    border-radius: 10px;
                    overflow: hidden;
                    margin: 1rem 0;
                    position: relative;
                }
                
                .coverage-fill {
                    height: 100%;
                    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                    transition: width 0.8s ease;
                    position: relative;
                }
                
                .coverage-fill::after {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
                    animation: shimmer 2s infinite;
                }
                
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
                
                .campaign-card {
                    background: white;
                    border-radius: 15px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                    border-left: 4px solid #3b82f6;
                    transition: all 0.3s ease;
                }
                
                .campaign-card:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
                }
                
                .campaign-card.expired {
                    border-left-color: #6b7280;
                    opacity: 0.8;
                }
                
                .patient-avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #2563eb, #8b5cf6);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                    font-size: 0.875rem;
                }
                
                .timeline {
                    position: relative;
                    padding-left: 2rem;
                }
                
                .timeline::before {
                    content: '';
                    position: absolute;
                    left: 0;
                    top: 0;
                    bottom: 0;
                    width: 2px;
                    background: #e5e7eb;
                }
                
                .timeline-item {
                    position: relative;
                    margin-bottom: 1.5rem;
                }
                
                .timeline-item::before {
                    content: '';
                    position: absolute;
                    left: -2rem;
                    top: 0.5rem;
                    width: 12px;
                    height: 12px;
                    border-radius: 50%;
                    background: #3b82f6;
                    border: 2px solid white;
                    box-shadow: 0 0 0 2px #3b82f6;
                }
                
                .hover-bg:hover {
                    background-color: #f8f9fa;
                }
            </style>

            <section class="campaign-dashboard">
                <div class="container">
                    <!-- Header Section -->
                    <div class="campaign-hero">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h1 class="display-6 fw-bold mb-3">
                                    <i class="fa fa-bullhorn me-3"></i>Campaign Fulfillment Center
                                </h1>
                                <p class="lead mb-0">Manage vaccination campaigns and track fulfillment progress for your facility</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="bg-white bg-opacity-20 rounded-pill px-3 py-2 d-inline-block">
                                    <i class="fa fa-map-marker-alt me-2"></i>
                                    <strong t-esc="provider.facility_id.name"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Success/Error Messages -->
                    <t t-if="success">
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <div class="d-flex align-items-center">
                                <i class="fa fa-check-circle me-3 fa-2x"></i>
                                <div>
                                    <h5 class="alert-heading mb-1">Success!</h5>
                                    <p class="mb-0">Vaccination administered successfully under the campaign.</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    </t>
                    
                    <t t-if="error">
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <div class="d-flex align-items-center">
                                <i class="fa fa-exclamation-triangle me-3 fa-2x"></i>
                                <div>
                                    <h5 class="alert-heading mb-1">Error!</h5>
                                    <p class="mb-0">
                                        <t t-if="error == '1'">Failed to administer vaccination. Please try again.</t>
                                        <t t-else=""><t t-esc="error"/></t>
                                    </p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    </t>

                    <div class="row">
                        <!-- Sidebar Navigation -->
                        <div class="col-lg-3">
                            <div class="dashboard-card">
                                <h4 class="fw-bold mb-4">Provider Dashboard</h4>
                                <div class="list-group">
                                    <a href="/mch/provider/dashboard" class="list-group-item list-group-item-action">
                                        <i class="fa fa-tachometer-alt me-2"></i>Dashboard
                                    </a>
                                    <a href="/mch/provider/patients" class="list-group-item list-group-item-action">
                                        <i class="fa fa-users me-2"></i>My Patients
                                    </a>
                                    <a href="/mch/provider/register-patient" class="list-group-item list-group-item-action">
                                        <i class="fa fa-user-plus me-2"></i>Register Patient
                                    </a>
                                    <a href="/mch/provider/vaccinate" class="list-group-item list-group-item-action">
                                        <i class="fa fa-syringe me-2"></i>Administer Vaccination
                                    </a>
                                    <a href="/mch/provider/vaccinations" class="list-group-item list-group-item-action">
                                        <i class="fa fa-list me-2"></i>Vaccination Records
                                    </a>
                                    <a href="/mch/provider/campaign-fulfillment" class="list-group-item list-group-item-action active">
                                        <i class="fa fa-bullhorn me-2"></i>Campaign Fulfillment
                                    </a>
                                    <a href="/web/session/logout" class="list-group-item list-group-item-action text-danger">
                                        <i class="fa fa-sign-out-alt me-2"></i>Logout
                                    </a>
                                </div>
                                
                                <!-- Quick Stats -->
                                <div class="mt-4 pt-3 border-top">
                                    <h6 class="fw-bold text-muted mb-3">Quick Stats</h6>
                                    <div class="small">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Active Campaigns:</span>
                                            <strong class="text-success" t-esc="total_active"/>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Coverage Rate:</span>
                                            <strong class="text-primary" t-esc="coverage_rate"/>%
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>Total Fulfilled:</span>
                                            <strong class="text-info" t-esc="(total_fulfilled_active or 0) + (total_fulfilled_past or 0)"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Main Content -->
                        <div class="col-lg-9">
                            <!-- Analytics Overview -->
                            <div class="stats-grid">
                                <div class="stat-card active">
                                    <div class="stat-number text-success" t-esc="total_active"/>
                                    <p class="text-muted mb-0">Active Campaigns</p>
                                    <small class="text-success">
                                        <i class="fa fa-arrow-up me-1"></i>
                                        <t t-esc="total_fulfilled_active"/> fulfillments
                                    </small>
                                </div>
                                <div class="stat-card past">
                                    <div class="stat-number text-gray-600" t-esc="total_past"/>
                                    <p class="text-muted mb-0">Past Campaigns</p>
                                    <small class="text-muted">
                                        <t t-esc="total_fulfilled_past"/> total fulfillments
                                    </small>
                                </div>
                                <div class="stat-card coverage">
                                    <div class="stat-number text-primary" t-esc="coverage_rate"/>%
                                    <p class="text-muted mb-0">Coverage Rate</p>
                                    <div class="coverage-meter">
                                        <div class="coverage-fill" t-att-style="'width: ' + str(coverage_rate) + '%;'"></div>
                                    </div>
                                </div>
                                <div class="stat-card performance">
                                    <div class="stat-number text-warning" t-esc="total_fulfilled_active"/>
                                    <p class="text-muted mb-0">Active Fulfillments</p>
                                    <small class="text-warning">
                                        <i class="fa fa-users me-1"></i>
                                        <t t-esc="total_patients"/> total patients
                                    </small>
                                </div>
                            </div>

                            <!-- Fulfillment Action Card -->
                            <div class="dashboard-card mb-4">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h4 class="fw-bold mb-2">
                                            <i class="fa fa-syringe me-2 text-primary"></i>Administer Campaign Vaccination
                                        </h4>
                                        <p class="text-muted mb-0">Record vaccinations under active campaigns for your patients</p>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <span class="campaign-badge badge-active">
                                            <i class="fa fa-clock me-1"></i>
                                            <t t-esc="len(active_campaigns)"/> Active
                                        </span>
                                    </div>
                                </div>
                                
                                <form method="post" class="mt-4">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-semibold">Select Campaign *</label>
                                            <select class="form-control" name="campaign_id" required="required" id="campaignSelect">
                                                <option value="">Choose Active Campaign</option>
                                                <t t-foreach="active_campaigns" t-as="campaign">
                                                    <option t-att-value="campaign.id" 
                                                            t-att-data-end-date="campaign.end_date"
                                                            t-att-data-vaccine="campaign.vaccine_id.name">
                                                        <t t-esc="campaign.name"/> 
                                                        (Ends: <t t-esc="campaign.end_date.strftime('%Y-%m-%d')"/>)
                                                    </option>
                                                </t>
                                            </select>
                                            <small class="text-muted">Only active campaigns are available for fulfillment</small>
                                        </div>
                                        <!-- <div class="col-md-6 mb-3">
                                            <label class="form-label fw-semibold">Patient *</label>
                                            <select class="form-control" name="patient_id" required="required" id="patientSelect">
                                                <option value="">Select Patient</option>
                                                <t t-foreach="facility_patients" t-as="patient">
                                                    <option t-att-value="patient.id" 
                                                            t-att-data-age="patient.age"
                                                            t-att-data-gender="patient.gender">
                                                        <t t-esc="patient.name"/> 
                                                        (<t t-esc="patient.age if patient.age else 'N/A'"/> years, <t t-esc="patient.gender if patient.gender else 'N/A'"/>)
                                                    </option>
                                                </t>
                                            </select>
                                        </div> -->
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-semibold">Patient *</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="patientSearch" placeholder="Search by name or phone..." autocomplete="off"/>
                                                <input type="hidden" name="patient_id" id="patientId" required="required"/>
                                            </div>
                                            <div id="patientResults" class="list-group mt-2 d-none"></div>
                                        </div>


                                    </div>

                                    <!-- Campaign Info Display -->
                                    <div id="campaignInfo" class="alert alert-info d-none">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <strong>Selected Campaign:</strong>
                                                <span id="selectedCampaignName" class="ms-2">-</span>
                                            </div>
                                            <div class="col-md-6">
                                                <strong>Vaccine:</strong>
                                                <span id="selectedVaccine" class="ms-2">-</span>
                                            </div>
                                        </div>
                                        <div class="row mt-2">
                                            <div class="col-md-6">
                                                <strong>End Date:</strong>
                                                <span id="selectedEndDate" class="ms-2">-</span>
                                            </div>
                                            <div class="col-md-6">
                                                <strong>Status:</strong>
                                                <span class="campaign-badge badge-active ms-2">Active</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Administration Notes</label>
                                        <textarea class="form-control" name="notes" rows="3" 
                                                placeholder="Enter any observations, reactions, or additional information about this vaccination..."></textarea>
                                        <small class="text-muted">Optional: Document any notable observations during vaccination</small>
                                    </div>

                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">
                                            <i class="fa fa-info-circle me-1"></i>
                                            This will record the vaccination under the selected campaign
                                        </small>
                                        <button type="submit" class="btn btn-primary btn-lg px-4">
                                            <i class="fa fa-check-circle me-2"></i>Administer Vaccination
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Campaigns Section -->
                            <div class="row">
                                <!-- Active Campaigns -->
                                <div class="col-md-6">
                                    <div class="dashboard-card">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="fw-bold mb-0">
                                                <i class="fa fa-play-circle me-2 text-success"></i>Active Campaigns
                                            </h5>
                                            <span class="badge bg-success" t-esc="len(active_campaigns)"/>
                                        </div>
                                        
                                        <t t-if="active_campaigns">
                                            <div class="timeline">
                                                <t t-foreach="active_campaigns" t-as="campaign">
                                                    <div class="timeline-item">
                                                        <div class="campaign-card">
                                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                                <h6 class="fw-bold mb-0" t-esc="campaign.name"/>
                                                                <span class="campaign-badge badge-active">Active</span>
                                                            </div>
                                                            <p class="text-muted small mb-2" t-esc="campaign.description or 'No description available'"/>
                                                            <div class="row small text-muted">
                                                                <div class="col-6">
                                                                    <i class="fa fa-syringe me-1"></i>
                                                                    <span t-esc="campaign.vaccine_id.name"/>
                                                                </div>
                                                                <div class="col-6">
                                                                    <i class="fa fa-users me-1"></i>
                                                                    <span t-esc="len(campaign.fulfillment_ids)"/> patients
                                                                </div>
                                                            </div>
                                                            <div class="mt-2">
                                                                <small class="text-muted">
                                                                    Ends: <t t-esc="campaign.end_date.strftime('%b %d, %Y')"/>
                                                                </small>
                                                                <div class="progress mt-1" style="height: 4px;">
                                                                    <div class="progress-bar bg-success"
                                                                        t-att-style="'width: ' + str(min(100, (len(campaign.fulfillment_ids) / max(total_patients or 1, 1)) * 100)) + '%;'"/>
                                                                    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>
                                        </t>
                                        <t t-else="">
                                            <div class="text-center text-muted py-4">
                                                <i class="fa fa-calendar-times fa-2x mb-3"></i>
                                                <p>No active campaigns running</p>
                                                <small class="text-muted">Check back later for new campaigns</small>
                                            </div>
                                        </t>
                                    </div>
                                </div>

                                <!-- Recent Fulfillments -->
                                <div class="col-md-6">
                                    <div class="dashboard-card">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="fw-bold mb-0">
                                                <i class="fa fa-history me-2 text-primary"></i>Recent Fulfillments
                                            </h5>
                                            <span class="badge bg-primary" t-esc="len(fulfilled_active or [])"/>
                                        </div>
                                        
                                        <t t-if="fulfilled_active">
                                            <div style="max-height: 400px; overflow-y: auto;">
                                                <t t-foreach="fulfilled_active[:10]" t-as="fulfillment">
                                                    <div class="d-flex align-items-center mb-3 p-2 rounded hover-bg">
                                                        <div class="patient-avatar me-3">
                                                            <t t-esc="fulfillment.patient_id.name[0].upper() if fulfillment.patient_id.name else '?'"/>
                                                        </div>
                                                        <div class="flex-grow-1">
                                                            <h6 class="mb-0 fw-semibold" t-esc="fulfillment.patient_id.name"/>
                                                            <small class="text-muted">
                                                                <t t-esc="fulfillment.campaign_id.name"/> ‚Ä¢ 
                                                                <t t-esc="fulfillment.date_administered.strftime('%b %d')"/>
                                                            </small>
                                                        </div>
                                                        <div class="text-end">
                                                            <small class="text-success">
                                                                <i class="fa fa-check-circle"></i>
                                                            </small>
                                                            <div>
                                                                <!-- FIXED: Changed from administered_by to provider_id -->
                                                                <small class="text-muted">
                                                                    by <t t-esc="fulfillment.provider_id.name"/>
                                                                </small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>
                                            <t t-if="len(fulfilled_active) > 10">
                                                <div class="text-center mt-3">
                                                    <small class="text-muted">
                                                        and <t t-esc="len(fulfilled_active) - 10"/> more fulfillments...
                                                    </small>
                                                </div>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <div class="text-center text-muted py-4">
                                                <i class="fa fa-user-slash fa-2x mb-3"></i>
                                                <p>No recent fulfillments</p>
                                                <small class="text-muted">Administer vaccinations to see them here</small>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>

                            <!-- Performance Analytics -->
                            <div class="dashboard-card mt-4">
                                <h5 class="fw-bold mb-4">
                                    <i class="fa fa-chart-line me-2 text-warning"></i>Performance Analytics
                                </h5>
                                
                                <div class="row">
                                    <div class="col-md-8">
                                        <h6 class="fw-semibold mb-3">Campaign Coverage Progress</h6>
                                        <t t-foreach="active_campaigns" t-as="campaign">
                                            <div class="mb-3">
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span class="small fw-semibold" t-esc="campaign.name"/>
                                                    <span class="small text-muted">
                                                        <t t-esc="len(campaign.fulfillment_ids)"/> / <t t-esc="total_patients"/> patients
                                                    </span>
                                                </div>
                                                <div class="progress" style="height: 8px;">
                                                    <div class="progress-bar bg-success"
                                                        t-att-style="'width: ' + str(min(100, (len(campaign.fulfillment_ids) / max(total_patients or 1, 1)) * 100)) + '%;'"/>
                                                    
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                    <div class="col-md-4">
                                        <h6 class="fw-semibold mb-3">Quick Stats</h6>
                                        <div class="list-group list-group-flush">
                                            <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                                <span class="small">Today's Fulfillments</span>
                                                <span class="badge bg-primary rounded-pill" t-esc="total_fulfilled_active"/>
                                            </div>
                                            <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                                <span class="small">Active Patients</span>
                                                <span class="badge bg-success rounded-pill" t-esc="total_patients"/>
                                            </div>
                                            <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                                <span class="small">Coverage Goal</span>
                                                <span class="badge bg-warning rounded-pill">80%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <script>
            <![CDATA[
            document.addEventListener('DOMContentLoaded', function() {
                // Campaign selection handler
                const campaignSelect = document.getElementById('campaignSelect');
                const campaignInfo = document.getElementById('campaignInfo');
                const selectedCampaignName = document.getElementById('selectedCampaignName');
                const selectedVaccine = document.getElementById('selectedVaccine');
                const selectedEndDate = document.getElementById('selectedEndDate');
                
                if (campaignSelect) {
                    campaignSelect.addEventListener('change', function() {
                        const selectedOption = this.options[this.selectedIndex];
                        if (selectedOption.value) {
                            selectedCampaignName.textContent = selectedOption.text.split(' (')[0];
                            selectedVaccine.textContent = selectedOption.getAttribute('data-vaccine');
                            selectedEndDate.textContent = selectedOption.getAttribute('data-end-date');
                            campaignInfo.classList.remove('d-none');
                        } else {
                            campaignInfo.classList.add('d-none');
                        }
                    });
                }
                
                // Patient selection enhancement
                const patientSelect = document.getElementById('patientSelect');
                if (patientSelect) {
                    patientSelect.addEventListener('focus', function() {
                        this.size = 5;
                    });
                    
                    patientSelect.addEventListener('blur', function() {
                        this.size = 1;
                    });
                    
                    patientSelect.addEventListener('change', function() {
                        this.size = 1;
                    });
                }
                
                // Auto-show campaign info if preselected
                if (campaignSelect && campaignSelect.value) {
                    campaignSelect.dispatchEvent(new Event('change'));
                }
                
                // Add hover effects
                const campaignCards = document.querySelectorAll('.campaign-card');
                campaignCards.forEach(card => {
                    card.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-2px)';
                    });
                    card.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                    });
                });
            });]]>
            </script>

            <script>
            <![CDATA[
                document.addEventListener("DOMContentLoaded", function () {
                    const searchInput = document.getElementById("patientSearch");
                    const resultBox = document.getElementById("patientResults");
                    const hiddenField = document.getElementById("patientId");

                    let searchTimeout = null;

                    searchInput.addEventListener("input", function () {
                        clearTimeout(searchTimeout);
                        const query = this.value.trim();

                        if (query.length < 2) {
                            resultBox.classList.add("d-none");
                            return;
                        }

                        searchTimeout = setTimeout(() => {
                            fetch("/mch/search/patient", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ query: query })
                            })
                            .then(res => res.json())
                            .then(data => {
                                resultBox.innerHTML = "";
                                if (data.length === 0) {
                                    resultBox.innerHTML = `<div class="list-group-item text-muted">No results found</div>`;
                                } else {
                                    data.forEach(p => {
                                        const item = document.createElement("a");
                                        item.href = "#";
                                        item.classList.add("list-group-item", "list-group-item-action");
                                        item.textContent = `${p.name} (${p.phone}) ‚Äî Age: ${p.age}`;
                                        item.dataset.id = p.id;
                                        resultBox.appendChild(item);
                                    });
                                }
                                resultBox.classList.remove("d-none");
                            });
                        }, 400);
                    });

                    resultBox.addEventListener("click", function (e) {
                        e.preventDefault();
                        const target = e.target.closest("a");
                        if (!target) return;

                        searchInput.value = target.textContent;
                        hiddenField.value = target.dataset.id;
                        resultBox.classList.add("d-none");
                    });

                    document.addEventListener("click", function (e) {
                        if (!resultBox.contains(e.target) && e.target !== searchInput) {
                            resultBox.classList.add("d-none");
                        }
                    });
                });]]>
                </script>

        </t>
    </template>

    <!-- Action Records -->
    <record id="mch_provider_website_action" model="ir.actions.act_url">
        <field name="name">Our Providers</field>
        <field name="url">/mch/providers</field>
        <field name="target">self</field>
    </record>

    <record id="mch_provider_login_action" model="ir.actions.act_url">
        <field name="name">Provider Login</field>
        <field name="url">/mch/provider/login</field>
        <field name="target">self</field>
    </record>

    <record id="mch_facility_website_action" model="ir.actions.act_url">
        <field name="name">Our Facilities</field>
        <field name="url">/mch/facilities</field>
        <field name="target">self</field>
    </record>

    <record id="mch_provider_signup_action" model="ir.actions.act_url">
        <field name="name">Provider Signup</field>
        <field name="url">/mch/provider/signup</field>
        <field name="target">self</field>
    </record>

    <record id="mch_provider_dashboard_action" model="ir.actions.act_url">
        <field name="name">Provider Dashboard</field>
        <field name="url">/mch/provider/dashboard</field>
        <field name="target">self</field>
    </record>

    <record id="mch_provider_register_patient_action" model="ir.actions.act_url">
        <field name="name">Provider Register Patient</field>
        <field name="url">/mch/provider/register-patient</field>
        <field name="target">self</field>
    </record>

    <record id="mch_provider_vaccinate_action" model="ir.actions.act_url">
        <field name="name">Provider Vaccinate</field>
        <field name="url">/mch/provider/vaccinate</field>
        <field name="target">self</field>
    </record>

    <record id="mch_provider_vaccinations_action" model="ir.actions.act_url">
        <field name="name">Provider Vaccinations</field>
        <field name="url">/mch/provider/vaccinations</field>
        <field name="target">self</field>
    </record>

    <record id="mch_provider_campaign_fulfillment_action" model="ir.actions.act_url">
        <field name="name">Provider Campaign Fulfillment</field>
        <field name="url">/mch/provider/campaign-fulfillment</field>
        <field name="target">self</field>
    </record>
</odoo>